{"ast":null,"code":"import \"core-js/modules/es.function.name.js\";\nimport { createCommentVNode as _createCommentVNode, createVNode as _createVNode, resolveComponent as _resolveComponent, withCtx as _withCtx, createTextVNode as _createTextVNode, createElementVNode as _createElementVNode, withKeys as _withKeys, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, createBlock as _createBlock, toDisplayString as _toDisplayString } from \"vue\";\nvar _hoisted_1 = {\n  \"class\": \"file-container\"\n};\nvar _hoisted_2 = {\n  \"class\": \"operation-bar\"\n};\nvar _hoisted_3 = {\n  \"class\": \"left\"\n};\nvar _hoisted_4 = {\n  \"class\": \"right\"\n};\nvar _hoisted_5 = {\n  \"class\": \"file-name\"\n};\nvar _hoisted_6 = {\n  \"class\": \"tag-list\"\n};\nvar _hoisted_7 = {\n  \"class\": \"pagination-container\"\n};\nvar _hoisted_8 = {\n  key: 0,\n  \"class\": \"tag-dialog-content\"\n};\nvar _hoisted_9 = {\n  \"class\": \"current-tags\"\n};\nvar _hoisted_10 = {\n  \"class\": \"add-tag\"\n};\nvar _hoisted_11 = {\n  \"class\": \"tag-select-row\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  var _component_el_icon = _resolveComponent(\"el-icon\");\n  var _component_el_button = _resolveComponent(\"el-button\");\n  var _component_el_upload = _resolveComponent(\"el-upload\");\n  var _component_el_input = _resolveComponent(\"el-input\");\n  var _component_el_option = _resolveComponent(\"el-option\");\n  var _component_el_select = _resolveComponent(\"el-select\");\n  var _component_el_tooltip = _resolveComponent(\"el-tooltip\");\n  var _component_el_table_column = _resolveComponent(\"el-table-column\");\n  var _component_el_tag = _resolveComponent(\"el-tag\");\n  var _component_el_table = _resolveComponent(\"el-table\");\n  var _component_el_pagination = _resolveComponent(\"el-pagination\");\n  var _component_el_dialog = _resolveComponent(\"el-dialog\");\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createCommentVNode(\" 搜索和操作栏 \"), _createElementVNode(\"div\", _hoisted_2, [_createElementVNode(\"div\", _hoisted_3, [_createVNode(_component_el_upload, {\n    \"class\": \"upload-btn\",\n    action: null,\n    \"http-request\": $setup.handleUpload,\n    \"show-file-list\": false,\n    multiple: true\n  }, {\n    \"default\": _withCtx(function () {\n      return [_createVNode(_component_el_button, {\n        type: \"primary\"\n      }, {\n        \"default\": _withCtx(function () {\n          return [_createVNode(_component_el_icon, null, {\n            \"default\": _withCtx(function () {\n              return [_createVNode($setup[\"Upload\"])];\n            }),\n            _: 1 /* STABLE */\n          }), _cache[7] || (_cache[7] = _createTextVNode(\" 上传文件 \"))];\n        }),\n        _: 1 /* STABLE */\n      })];\n    }),\n    _: 1 /* STABLE */\n  })]), _createElementVNode(\"div\", _hoisted_4, [_createVNode(_component_el_input, {\n    modelValue: $setup.searchQuery,\n    \"onUpdate:modelValue\": _cache[0] || (_cache[0] = function ($event) {\n      return $setup.searchQuery = $event;\n    }),\n    placeholder: \"搜索文件名\",\n    \"class\": \"search-input\",\n    clearable: \"\",\n    onKeyup: _withKeys($setup.handleSearch, [\"enter\"])\n  }, {\n    suffix: _withCtx(function () {\n      return [_createVNode(_component_el_icon, null, {\n        \"default\": _withCtx(function () {\n          return [_createVNode($setup[\"Search\"])];\n        }),\n        _: 1 /* STABLE */\n      })];\n    }),\n    _: 1 /* STABLE */\n  }, 8 /* PROPS */, [\"modelValue\"]), _createVNode(_component_el_select, {\n    modelValue: $setup.fileType,\n    \"onUpdate:modelValue\": _cache[1] || (_cache[1] = function ($event) {\n      return $setup.fileType = $event;\n    }),\n    placeholder: \"文件类型\",\n    clearable: \"\",\n    onChange: $setup.handleSearch\n  }, {\n    \"default\": _withCtx(function () {\n      return [_createVNode(_component_el_option, {\n        label: \"全部\",\n        value: \"\"\n      }), _createVNode(_component_el_option, {\n        label: \"文档\",\n        value: \".doc,.docx,.pdf,.txt\"\n      }), _createVNode(_component_el_option, {\n        label: \"代码\",\n        value: \".js,.java,.py,.cpp,.cs,.html,.css,.php,.sql\"\n      }), _createVNode(_component_el_option, {\n        label: \"图片\",\n        value: \".jpg,.jpeg,.png,.gif\"\n      }), _createVNode(_component_el_option, {\n        label: \"视频\",\n        value: \".mp4,.avi,.mov\"\n      }), _createVNode(_component_el_option, {\n        label: \"音频\",\n        value: \".mp3,.wav,.ogg\"\n      }), _createVNode(_component_el_option, {\n        label: \"压缩包\",\n        value: \".zip,.rar,.7z\"\n      }), _createVNode(_component_el_option, {\n        label: \"其他\",\n        value: \"other\"\n      })];\n    }),\n    _: 1 /* STABLE */\n  }, 8 /* PROPS */, [\"modelValue\"]), _createVNode(_component_el_select, {\n    modelValue: $setup.selectedFilterTag,\n    \"onUpdate:modelValue\": _cache[2] || (_cache[2] = function ($event) {\n      return $setup.selectedFilterTag = $event;\n    }),\n    placeholder: \"按标签筛选\",\n    clearable: \"\",\n    onChange: $setup.handleSearch,\n    \"class\": \"tag-filter\"\n  }, {\n    \"default\": _withCtx(function () {\n      return [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($setup.tagList, function (tag) {\n        return _openBlock(), _createBlock(_component_el_option, {\n          key: tag.id,\n          label: tag.name,\n          value: tag.id\n        }, null, 8 /* PROPS */, [\"label\", \"value\"]);\n      }), 128 /* KEYED_FRAGMENT */))];\n    }),\n    _: 1 /* STABLE */\n  }, 8 /* PROPS */, [\"modelValue\"])])]), _createCommentVNode(\" 文件列表 \"), _createVNode(_component_el_table, {\n    data: $setup.fileList,\n    border: \"\",\n    style: {\n      \"width\": \"100%\"\n    }\n  }, {\n    \"default\": _withCtx(function () {\n      return [_createVNode(_component_el_table_column, {\n        prop: \"original_name\",\n        label: \"文件名\",\n        \"min-width\": \"200\"\n      }, {\n        \"default\": _withCtx(function (_ref) {\n          var row = _ref.row;\n          return [_createVNode(_component_el_tooltip, {\n            content: row.original_name,\n            placement: \"top\"\n          }, {\n            \"default\": _withCtx(function () {\n              return [_createElementVNode(\"span\", _hoisted_5, _toDisplayString(row.original_name), 1 /* TEXT */)];\n            }),\n            _: 2 /* DYNAMIC */\n          }, 1032 /* PROPS, DYNAMIC_SLOTS */, [\"content\"])];\n        }),\n        _: 1 /* STABLE */\n      }), _createVNode(_component_el_table_column, {\n        prop: \"file_type\",\n        label: \"类型\",\n        width: \"100\"\n      }, {\n        \"default\": _withCtx(function (_ref2) {\n          var row = _ref2.row;\n          return [_createTextVNode(_toDisplayString(row.file_type), 1 /* TEXT */)];\n        }),\n        _: 1 /* STABLE */\n      }), _createVNode(_component_el_table_column, {\n        prop: \"file_size\",\n        label: \"大小\",\n        width: \"120\"\n      }, {\n        \"default\": _withCtx(function (_ref3) {\n          var row = _ref3.row;\n          return [_createTextVNode(_toDisplayString($setup.formatFileSize(row.file_size)), 1 /* TEXT */)];\n        }),\n        _: 1 /* STABLE */\n      }), _createVNode(_component_el_table_column, {\n        prop: \"created_at\",\n        label: \"上传时间\",\n        width: \"180\"\n      }, {\n        \"default\": _withCtx(function (_ref4) {\n          var row = _ref4.row;\n          return [_createTextVNode(_toDisplayString($setup.formatDate(row.created_at)), 1 /* TEXT */)];\n        }),\n        _: 1 /* STABLE */\n      }), _createVNode(_component_el_table_column, {\n        label: \"标签\",\n        \"min-width\": \"150\"\n      }, {\n        \"default\": _withCtx(function (_ref5) {\n          var row = _ref5.row;\n          return [_createElementVNode(\"div\", _hoisted_6, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList(row.tags, function (tag) {\n            return _openBlock(), _createBlock(_component_el_tag, {\n              key: tag.id,\n              size: \"small\",\n              \"class\": \"tag-item\"\n            }, {\n              \"default\": _withCtx(function () {\n                return [_createTextVNode(_toDisplayString(tag.name), 1 /* TEXT */)];\n              }),\n              _: 2 /* DYNAMIC */\n            }, 1024 /* DYNAMIC_SLOTS */);\n          }), 128 /* KEYED_FRAGMENT */)), _createVNode(_component_el_button, {\n            type: \"primary\",\n            link: \"\",\n            size: \"small\",\n            onClick: function onClick($event) {\n              return $setup.handleManageTags(row);\n            }\n          }, {\n            \"default\": _withCtx(function () {\n              return _cache[8] || (_cache[8] = [_createTextVNode(\" 管理标签 \")]);\n            }),\n            _: 2 /* DYNAMIC */\n          }, 1032 /* PROPS, DYNAMIC_SLOTS */, [\"onClick\"])])];\n        }),\n        _: 1 /* STABLE */\n      }), _createVNode(_component_el_table_column, {\n        label: \"操作\",\n        width: \"200\",\n        fixed: \"right\"\n      }, {\n        \"default\": _withCtx(function (_ref6) {\n          var row = _ref6.row;\n          return [_createVNode(_component_el_button, {\n            type: \"primary\",\n            link: \"\",\n            onClick: function onClick($event) {\n              return $setup.handleDownload(row);\n            }\n          }, {\n            \"default\": _withCtx(function () {\n              return [_createVNode(_component_el_icon, null, {\n                \"default\": _withCtx(function () {\n                  return [_createVNode($setup[\"Download\"])];\n                }),\n                _: 1 /* STABLE */\n              }), _cache[9] || (_cache[9] = _createTextVNode(\" 下载 \"))];\n            }),\n            _: 2 /* DYNAMIC */\n          }, 1032 /* PROPS, DYNAMIC_SLOTS */, [\"onClick\"]), _createVNode(_component_el_button, {\n            type: \"danger\",\n            link: \"\",\n            onClick: function onClick($event) {\n              return $setup.handleDelete(row);\n            }\n          }, {\n            \"default\": _withCtx(function () {\n              return [_createVNode(_component_el_icon, null, {\n                \"default\": _withCtx(function () {\n                  return [_createVNode($setup[\"Delete\"])];\n                }),\n                _: 1 /* STABLE */\n              }), _cache[10] || (_cache[10] = _createTextVNode(\" 删除 \"))];\n            }),\n            _: 2 /* DYNAMIC */\n          }, 1032 /* PROPS, DYNAMIC_SLOTS */, [\"onClick\"])];\n        }),\n        _: 1 /* STABLE */\n      })];\n    }),\n    _: 1 /* STABLE */\n  }, 8 /* PROPS */, [\"data\"]), _createCommentVNode(\" 分页 \"), _createElementVNode(\"div\", _hoisted_7, [_createVNode(_component_el_pagination, {\n    \"current-page\": $setup.currentPage,\n    \"onUpdate:currentPage\": _cache[3] || (_cache[3] = function ($event) {\n      return $setup.currentPage = $event;\n    }),\n    \"page-size\": $setup.pageSize,\n    \"onUpdate:pageSize\": _cache[4] || (_cache[4] = function ($event) {\n      return $setup.pageSize = $event;\n    }),\n    total: $setup.total,\n    \"page-sizes\": [10, 20, 50, 100],\n    layout: \"total, sizes, prev, pager, next\",\n    onSizeChange: $setup.handleSizeChange,\n    onCurrentChange: $setup.handleCurrentChange\n  }, null, 8 /* PROPS */, [\"current-page\", \"page-size\", \"total\"])]), _createCommentVNode(\" 添加标签管理对话框 \"), _createVNode(_component_el_dialog, {\n    modelValue: $setup.tagDialogVisible,\n    \"onUpdate:modelValue\": _cache[6] || (_cache[6] = function ($event) {\n      return $setup.tagDialogVisible = $event;\n    }),\n    title: \"管理标签\",\n    width: \"500px\"\n  }, {\n    \"default\": _withCtx(function () {\n      return [$setup.selectedFile ? (_openBlock(), _createElementBlock(\"div\", _hoisted_8, [_createElementVNode(\"div\", _hoisted_9, [_cache[11] || (_cache[11] = _createElementVNode(\"h4\", null, \"当前标签：\", -1 /* HOISTED */)), (_openBlock(true), _createElementBlock(_Fragment, null, _renderList($setup.currentFileTags, function (tag) {\n        return _openBlock(), _createBlock(_component_el_tag, {\n          key: tag.id,\n          closable: \"\",\n          onClose: function onClose($event) {\n            return $setup.handleRemoveTag(tag);\n          }\n        }, {\n          \"default\": _withCtx(function () {\n            return [_createTextVNode(_toDisplayString(tag.name), 1 /* TEXT */)];\n          }),\n          _: 2 /* DYNAMIC */\n        }, 1032 /* PROPS, DYNAMIC_SLOTS */, [\"onClose\"]);\n      }), 128 /* KEYED_FRAGMENT */))]), _createElementVNode(\"div\", _hoisted_10, [_cache[13] || (_cache[13] = _createElementVNode(\"h4\", null, \"添加标签：\", -1 /* HOISTED */)), _createElementVNode(\"div\", _hoisted_11, [_createVNode(_component_el_select, {\n        modelValue: $setup.selectedTag,\n        \"onUpdate:modelValue\": _cache[5] || (_cache[5] = function ($event) {\n          return $setup.selectedTag = $event;\n        }),\n        placeholder: \"选择标签\",\n        \"class\": \"tag-select\"\n      }, {\n        \"default\": _withCtx(function () {\n          return [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($setup.availableTags, function (tag) {\n            return _openBlock(), _createBlock(_component_el_option, {\n              key: tag.id,\n              label: tag.name,\n              value: tag.id\n            }, null, 8 /* PROPS */, [\"label\", \"value\"]);\n          }), 128 /* KEYED_FRAGMENT */))];\n        }),\n        _: 1 /* STABLE */\n      }, 8 /* PROPS */, [\"modelValue\"]), _createVNode(_component_el_button, {\n        type: \"primary\",\n        onClick: $setup.handleAddTag\n      }, {\n        \"default\": _withCtx(function () {\n          return _cache[12] || (_cache[12] = [_createTextVNode(\"添加\")]);\n        }),\n        _: 1 /* STABLE */\n      })])])])) : _createCommentVNode(\"v-if\", true)];\n    }),\n    _: 1 /* STABLE */\n  }, 8 /* PROPS */, [\"modelValue\"])]);\n}","map":{"version":3,"names":["key","_createElementBlock","_hoisted_1","_createCommentVNode","_createElementVNode","_hoisted_2","_hoisted_3","_createVNode","_component_el_upload","action","$setup","handleUpload","multiple","_withCtx","_component_el_button","type","_component_el_icon","_","_createTextVNode","_hoisted_4","_component_el_input","modelValue","searchQuery","_cache","$event","placeholder","clearable","onKeyup","_withKeys","handleSearch","suffix","_component_el_select","fileType","onChange","_component_el_option","label","value","selectedFilterTag","_Fragment","_renderList","tagList","tag","_createBlock","id","name","_component_el_table","data","fileList","border","style","_component_el_table_column","prop","_ref","row","_component_el_tooltip","content","original_name","placement","_hoisted_5","_toDisplayString","width","_ref2","file_type","_ref3","formatFileSize","file_size","_ref4","formatDate","created_at","_ref5","_hoisted_6","tags","_component_el_tag","size","link","onClick","handleManageTags","fixed","_ref6","handleDownload","handleDelete","_hoisted_7","_component_el_pagination","currentPage","pageSize","total","layout","onSizeChange","handleSizeChange","onCurrentChange","handleCurrentChange","_component_el_dialog","tagDialogVisible","title","selectedFile","_hoisted_8","_hoisted_9","currentFileTags","closable","onClose","handleRemoveTag","_hoisted_10","_hoisted_11","selectedTag","availableTags","handleAddTag"],"sources":["/home/devbox/project/src/views/file/index.vue"],"sourcesContent":["<template>\n  <div class=\"file-container\">\n    <!-- 搜索和操作栏 -->\n    <div class=\"operation-bar\">\n      <div class=\"left\">\n        <el-upload\n          class=\"upload-btn\"\n          :action=\"null\"\n          :http-request=\"handleUpload\"\n          :show-file-list=\"false\"\n          :multiple=\"true\"\n        >\n          <el-button type=\"primary\">\n            <el-icon><Upload /></el-icon>\n            上传文件\n          </el-button>\n        </el-upload>\n      </div>\n      <div class=\"right\">\n        <el-input\n          v-model=\"searchQuery\"\n          placeholder=\"搜索文件名\"\n          class=\"search-input\"\n          clearable\n          @keyup.enter=\"handleSearch\"\n        >\n          <template #suffix>\n            <el-icon><Search /></el-icon>\n          </template>\n        </el-input>\n        <el-select v-model=\"fileType\" placeholder=\"文件类型\" clearable @change=\"handleSearch\">\n          <el-option label=\"全部\" value=\"\" />\n          <el-option label=\"文档\" value=\".doc,.docx,.pdf,.txt\" />\n          <el-option label=\"代码\" value=\".js,.java,.py,.cpp,.cs,.html,.css,.php,.sql\" />\n          <el-option label=\"图片\" value=\".jpg,.jpeg,.png,.gif\" />\n          <el-option label=\"视频\" value=\".mp4,.avi,.mov\" />\n          <el-option label=\"音频\" value=\".mp3,.wav,.ogg\" />\n          <el-option label=\"压缩包\" value=\".zip,.rar,.7z\" />\n          <el-option label=\"其他\" value=\"other\" />\n        </el-select>\n        <el-select\n          v-model=\"selectedFilterTag\"\n          placeholder=\"按标签筛选\"\n          clearable\n          @change=\"handleSearch\"\n          class=\"tag-filter\"\n        >\n          <el-option\n            v-for=\"tag in tagList\"\n            :key=\"tag.id\"\n            :label=\"tag.name\"\n            :value=\"tag.id\"\n          />\n        </el-select>\n      </div>\n    </div>\n\n    <!-- 文件列表 -->\n    <el-table :data=\"fileList\" border style=\"width: 100%\">\n      <el-table-column prop=\"original_name\" label=\"文件名\" min-width=\"200\">\n        <template #default=\"{ row }\">\n          <el-tooltip :content=\"row.original_name\" placement=\"top\">\n            <span class=\"file-name\">{{ row.original_name }}</span>\n          </el-tooltip>\n        </template>\n      </el-table-column>\n      <el-table-column prop=\"file_type\" label=\"类型\" width=\"100\">\n        <template #default=\"{ row }\">\n          {{ row.file_type }}\n        </template>\n      </el-table-column>\n      <el-table-column prop=\"file_size\" label=\"大小\" width=\"120\">\n        <template #default=\"{ row }\">\n          {{ formatFileSize(row.file_size) }}\n        </template>\n      </el-table-column>\n      <el-table-column prop=\"created_at\" label=\"上传时间\" width=\"180\">\n        <template #default=\"{ row }\">\n          {{ formatDate(row.created_at) }}\n        </template>\n      </el-table-column>\n      <el-table-column label=\"标签\" min-width=\"150\">\n        <template #default=\"{ row }\">\n          <div class=\"tag-list\">\n            <el-tag\n              v-for=\"tag in row.tags\"\n              :key=\"tag.id\"\n              size=\"small\"\n              class=\"tag-item\"\n            >\n              {{ tag.name }}\n            </el-tag>\n            <el-button\n              type=\"primary\"\n              link\n              size=\"small\"\n              @click=\"handleManageTags(row)\"\n            >\n              管理标签\n            </el-button>\n          </div>\n        </template>\n      </el-table-column>\n      <el-table-column label=\"操作\" width=\"200\" fixed=\"right\">\n        <template #default=\"{ row }\">\n          <el-button type=\"primary\" link @click=\"handleDownload(row)\">\n            <el-icon><Download /></el-icon>\n            下载\n          </el-button>\n          <el-button type=\"danger\" link @click=\"handleDelete(row)\">\n            <el-icon><Delete /></el-icon>\n            删除\n          </el-button>\n        </template>\n      </el-table-column>\n    </el-table>\n\n    <!-- 分页 -->\n    <div class=\"pagination-container\">\n      <el-pagination\n        v-model:current-page=\"currentPage\"\n        v-model:page-size=\"pageSize\"\n        :total=\"total\"\n        :page-sizes=\"[10, 20, 50, 100]\"\n        layout=\"total, sizes, prev, pager, next\"\n        @size-change=\"handleSizeChange\"\n        @current-change=\"handleCurrentChange\"\n      />\n    </div>\n\n    <!-- 添加标签管理对话框 -->\n    <el-dialog\n      v-model=\"tagDialogVisible\"\n      title=\"管理标签\"\n      width=\"500px\"\n    >\n      <div v-if=\"selectedFile\" class=\"tag-dialog-content\">\n        <div class=\"current-tags\">\n          <h4>当前标签：</h4>\n          <el-tag\n            v-for=\"tag in currentFileTags\"\n            :key=\"tag.id\"\n            closable\n            @close=\"handleRemoveTag(tag)\"\n          >\n            {{ tag.name }}\n          </el-tag>\n        </div>\n\n        <div class=\"add-tag\">\n          <h4>添加标签：</h4>\n          <div class=\"tag-select-row\">\n            <el-select\n              v-model=\"selectedTag\"\n              placeholder=\"选择标签\"\n              class=\"tag-select\"\n            >\n              <el-option\n                v-for=\"tag in availableTags\"\n                :key=\"tag.id\"\n                :label=\"tag.name\"\n                :value=\"tag.id\"\n              />\n            </el-select>\n            <el-button type=\"primary\" @click=\"handleAddTag\">添加</el-button>\n          </div>\n        </div>\n      </div>\n    </el-dialog>\n  </div>\n</template>\n\n<script setup>\nimport { ref, onMounted, watch, computed } from 'vue';\nimport { ElMessage, ElMessageBox } from 'element-plus';\nimport { Search, Upload, Download, Delete } from '@element-plus/icons-vue';\nimport { getFileList, uploadFile, downloadFile, deleteFile } from '@/api/file';\nimport { getTagList, addTagToFile, removeTagFromFile, getFileTags } from '@/api/tag';\n\n// 状态变量\nconst fileList = ref([]);\nconst total = ref(0);\nconst currentPage = ref(1);\nconst pageSize = ref(10);\nconst searchQuery = ref('');\nconst fileType = ref('');\n\n// 标签相关的状态\nconst tagList = ref([]);\nconst selectedFile = ref(null);\nconst currentFileTags = ref([]);\nconst selectedTag = ref(null);\nconst tagDialogVisible = ref(false);\n\n// 添加标签过滤状态\nconst selectedFilterTag = ref(null);\n\n// 计算可用的标签（排除已添加的标签）\nconst availableTags = computed(() => {\n  const currentTagIds = currentFileTags.value.map(tag => tag.id);\n  return tagList.value.filter(tag => !currentTagIds.includes(tag.id));\n});\n\n// 获取文件列表\nconst getFiles = async () => {\n  try {\n    const res = await getFileList({\n      page: currentPage.value,\n      pageSize: pageSize.value,\n      fileType: fileType.value,\n      keyword: searchQuery.value,\n      tagId: selectedFilterTag.value\n    });\n    fileList.value = res.Data.files;\n    total.value = res.Data.total;\n  } catch (error) {\n    ElMessage.error('获取文件列表失败');\n    console.error('获取文件列表失败:', error);\n  }\n};\n\n// 文件上传\nconst handleUpload = async ({ file }) => {\n  try {\n    const formData = new FormData();\n    formData.append('file', file);\n    const res = await uploadFile(formData);\n    if (res.Success) {\n      ElMessage.success('上传成功');\n      getFiles();\n    }\n  } catch (error) {\n    ElMessage.error(error.response?.data?.Msg || '上传失败');\n    console.error('上传失败:', error);\n  }\n};\n\n// 文件下载\nconst handleDownload = async (row) => {\n  try {\n    const res = await downloadFile(row.id);\n    \n    // 检查是否是错误响应\n    if (res instanceof Blob && res.type === 'application/json') {\n      const text = await res.text();\n      const error = JSON.parse(text);\n      throw new Error(error.Msg || '下载失败');\n    }\n    \n    // 创建 blob URL\n    const blob = new Blob([res], { type: 'application/octet-stream' });\n    const url = window.URL.createObjectURL(blob);\n    \n    // 创建临时下载链接\n    const link = document.createElement('a');\n    link.href = url;\n    link.download = row.original_name;\n    document.body.appendChild(link);\n    link.click();\n    \n    // 清理\n    document.body.removeChild(link);\n    window.URL.revokeObjectURL(url);\n  } catch (error) {\n    ElMessage.error(error.message || '下载失败');\n    console.error('下载失败:', error);\n  }\n};\n\n// 文件删除\nconst handleDelete = (row) => {\n  ElMessageBox.confirm('确定要删除该文件吗？', '提示', {\n    type: 'warning'\n  }).then(async () => {\n    try {\n      await deleteFile(row.id);\n      ElMessage.success('删除成功');\n      getFiles();\n    } catch (error) {\n      console.error('删除失败:', error);\n    }\n  });\n};\n\n// 搜索处理\nconst handleSearch = () => {\n  currentPage.value = 1;\n  getFiles();\n};\n\n// 分页处理\nconst handleSizeChange = (val) => {\n  pageSize.value = val;\n  getFiles();\n};\n\nconst handleCurrentChange = (val) => {\n  currentPage.value = val;\n  getFiles();\n};\n\n// 工具函数\nconst formatFileSize = (size) => {\n  if (size < 1024) return size + ' B';\n  if (size < 1024 * 1024) return (size / 1024).toFixed(2) + ' KB';\n  if (size < 1024 * 1024 * 1024) return (size / (1024 * 1024)).toFixed(2) + ' MB';\n  return (size / (1024 * 1024 * 1024)).toFixed(2) + ' GB';\n};\n\nconst formatDate = (date) => {\n  return new Date(date).toLocaleString();\n};\n\n// 获取所有标签\nconst getTags = async () => {\n  try {\n    const res = await getTagList();\n    tagList.value = res.Data;\n  } catch (error) {\n    console.error('获取标签列表失败:', error);\n  }\n};\n\n// 获取文件的标签\nconst getFileTagList = async (fileId) => {\n  try {\n    const res = await getFileTags(fileId);\n    currentFileTags.value = res.Data;\n  } catch (error) {\n    console.error('获取文件标签失败:', error);\n  }\n};\n\n// 打开标签管理对话框\nconst handleManageTags = async (file) => {\n  selectedFile.value = file;\n  await getFileTagList(file.id);\n  tagDialogVisible.value = true;\n};\n\n// 添加标签\nconst handleAddTag = async () => {\n  if (!selectedTag.value) return;\n  \n  try {\n    await addTagToFile({\n      fileId: selectedFile.value.id,\n      tagId: selectedTag.value\n    });\n    await getFileTagList(selectedFile.value.id);\n    await getFiles(); // 刷新文件列表以更新标签\n    selectedTag.value = null;\n    ElMessage.success('添加标签成功');\n  } catch (error) {\n    console.error('添加标签失败:', error);\n  }\n};\n\n// 移除标签\nconst handleRemoveTag = async (tag) => {\n  try {\n    await removeTagFromFile(selectedFile.value.id, tag.id);\n    await getFileTagList(selectedFile.value.id);\n    await getFiles(); // 刷新文件列表以更新标签\n    ElMessage.success('移除标签成功');\n  } catch (error) {\n    console.error('移除标签失败:', error);\n  }\n};\n\n// 初始化\nonMounted(async () => {\n  await getFiles();\n  await getTags();\n});\n\n// 监听文件类型变化\nwatch([fileType, selectedFilterTag], () => {\n  handleSearch();\n});\n</script>\n\n<style lang=\"scss\" scoped>\n.file-container {\n  .operation-bar {\n    display: flex;\n    justify-content: space-between;\n    margin-bottom: 20px;\n\n    .right {\n      display: flex;\n      gap: 10px;\n\n      .search-input {\n        width: 200px;\n      }\n\n      .el-select {\n        width: 120px;\n      }\n\n      .tag-filter {\n        width: 120px;\n      }\n    }\n  }\n\n  .file-name {\n    display: inline-block;\n    max-width: 300px;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n  }\n\n  .pagination-container {\n    margin-top: 20px;\n    display: flex;\n    justify-content: flex-end;\n  }\n}\n\n.tag-list {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 5px;\n  align-items: center;\n\n  .tag-item {\n    margin-right: 5px;\n  }\n}\n\n.tag-dialog-content {\n  .current-tags {\n    margin-bottom: 20px;\n\n    h4 {\n      margin-bottom: 10px;\n    }\n\n    .el-tag {\n      margin-right: 8px;\n      margin-bottom: 8px;\n    }\n  }\n\n  .add-tag {\n    h4 {\n      margin-bottom: 10px;\n    }\n\n    .tag-select-row {\n      display: flex;\n      gap: 10px;\n\n      .tag-select {\n        flex: 1;\n      }\n    }\n  }\n}\n</style>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}