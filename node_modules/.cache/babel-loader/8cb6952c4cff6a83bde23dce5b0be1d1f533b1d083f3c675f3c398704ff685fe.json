{"ast":null,"code":"import _toConsumableArray from \"/home/devbox/project/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";\nimport { createCommentVNode as _createCommentVNode, createElementVNode as _createElementVNode, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, resolveComponent as _resolveComponent, createBlock as _createBlock, withCtx as _withCtx, createVNode as _createVNode, createTextVNode as _createTextVNode, toDisplayString as _toDisplayString } from \"vue\";\nvar _hoisted_1 = {\n  \"class\": \"backup-container\"\n};\nvar _hoisted_2 = {\n  \"class\": \"operation-content\"\n};\nvar _hoisted_3 = {\n  \"class\": \"card-header\"\n};\nvar _hoisted_4 = {\n  \"class\": \"file-name\"\n};\nvar _hoisted_5 = {\n  \"class\": \"backup-list\"\n};\nvar _hoisted_6 = {\n  \"class\": \"backup-info\"\n};\nvar _hoisted_7 = {\n  \"class\": \"version\"\n};\nvar _hoisted_8 = {\n  \"class\": \"operations\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  var _component_el_option = _resolveComponent(\"el-option\");\n  var _component_el_select = _resolveComponent(\"el-select\");\n  var _component_el_form_item = _resolveComponent(\"el-form-item\");\n  var _component_el_button = _resolveComponent(\"el-button\");\n  var _component_el_form = _resolveComponent(\"el-form\");\n  var _component_el_card = _resolveComponent(\"el-card\");\n  var _component_el_empty = _resolveComponent(\"el-empty\");\n  var _component_el_timeline_item = _resolveComponent(\"el-timeline-item\");\n  var _component_el_timeline = _resolveComponent(\"el-timeline\");\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createCommentVNode(\" 文件选择和备份操作 \"), _createVNode(_component_el_card, {\n    \"class\": \"operation-card\"\n  }, {\n    header: _withCtx(function () {\n      return _cache[1] || (_cache[1] = [_createElementVNode(\"div\", {\n        \"class\": \"card-header\"\n      }, [_createElementVNode(\"span\", null, \"备份管理\")], -1 /* HOISTED */)]);\n    }),\n    \"default\": _withCtx(function () {\n      return [_createElementVNode(\"div\", _hoisted_2, [_createVNode(_component_el_form, {\n        model: $setup.form,\n        \"label-width\": \"80px\"\n      }, {\n        \"default\": _withCtx(function () {\n          return [_createVNode(_component_el_form_item, {\n            label: \"选择文件\"\n          }, {\n            \"default\": _withCtx(function () {\n              return [_createVNode(_component_el_select, {\n                modelValue: $setup.form.fileId,\n                \"onUpdate:modelValue\": _cache[0] || (_cache[0] = function ($event) {\n                  return $setup.form.fileId = $event;\n                }),\n                placeholder: \"请选择文件\",\n                filterable: \"\",\n                onChange: $setup.handleFileSelect,\n                style: {\n                  \"width\": \"100%\"\n                }\n              }, {\n                \"default\": _withCtx(function () {\n                  return [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($setup.fileList, function (file) {\n                    return _openBlock(), _createBlock(_component_el_option, {\n                      key: file.id,\n                      label: file.original_name,\n                      value: file.id\n                    }, null, 8 /* PROPS */, [\"label\", \"value\"]);\n                  }), 128 /* KEYED_FRAGMENT */))];\n                }),\n                _: 1 /* STABLE */\n              }, 8 /* PROPS */, [\"modelValue\"])];\n            }),\n            _: 1 /* STABLE */\n          }), _createVNode(_component_el_form_item, null, {\n            \"default\": _withCtx(function () {\n              return [_createVNode(_component_el_button, {\n                type: \"primary\",\n                disabled: !$setup.form.fileId,\n                onClick: $setup.handleCreateBackup\n              }, {\n                \"default\": _withCtx(function () {\n                  return _cache[2] || (_cache[2] = [_createTextVNode(\" 创建备份 \")]);\n                }),\n                _: 1 /* STABLE */\n              }, 8 /* PROPS */, [\"disabled\"])];\n            }),\n            _: 1 /* STABLE */\n          })];\n        }),\n        _: 1 /* STABLE */\n      }, 8 /* PROPS */, [\"model\"])])];\n    }),\n    _: 1 /* STABLE */\n  }), _createCommentVNode(\" 备份列表 \"), $setup.form.fileId ? (_openBlock(), _createBlock(_component_el_card, {\n    key: 0,\n    \"class\": \"backup-list-card\"\n  }, {\n    header: _withCtx(function () {\n      return [_createElementVNode(\"div\", _hoisted_3, [_cache[3] || (_cache[3] = _createElementVNode(\"span\", null, \"备份列表\", -1 /* HOISTED */)), _createElementVNode(\"span\", _hoisted_4, _toDisplayString($setup.selectedFileName), 1 /* TEXT */)])];\n    }),\n    \"default\": _withCtx(function () {\n      return [_createElementVNode(\"div\", _hoisted_5, [!$setup.backupList.length ? (_openBlock(), _createBlock(_component_el_empty, {\n        key: 0,\n        description: \"暂无备份\"\n      })) : (_openBlock(), _createBlock(_component_el_timeline, {\n        key: 1\n      }, {\n        \"default\": _withCtx(function () {\n          return [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($setup.backupList, function (backup) {\n            return _openBlock(), _createBlock(_component_el_timeline_item, {\n              key: backup.id,\n              timestamp: $setup.formatDate(backup.created_at),\n              placement: \"top\"\n            }, {\n              \"default\": _withCtx(function () {\n                return [_createVNode(_component_el_card, {\n                  \"class\": \"backup-item\"\n                }, {\n                  \"default\": _withCtx(function () {\n                    return [_createElementVNode(\"div\", _hoisted_6, [_createElementVNode(\"span\", _hoisted_7, \"版本 \" + _toDisplayString(backup.version), 1 /* TEXT */), _createElementVNode(\"div\", _hoisted_8, [_createVNode(_component_el_button, {\n                      type: \"primary\",\n                      link: \"\",\n                      onClick: function onClick($event) {\n                        return $setup.handleRestore(backup);\n                      }\n                    }, {\n                      \"default\": _withCtx(function () {\n                        return _toConsumableArray(_cache[4] || (_cache[4] = [_createTextVNode(\" 恢复到此版本 \")]));\n                      }),\n                      _: 2 /* DYNAMIC */\n                    }, 1032 /* PROPS, DYNAMIC_SLOTS */, [\"onClick\"]), _createVNode(_component_el_button, {\n                      type: \"danger\",\n                      link: \"\",\n                      onClick: function onClick($event) {\n                        return $setup.handleDelete(backup);\n                      }\n                    }, {\n                      \"default\": _withCtx(function () {\n                        return _toConsumableArray(_cache[5] || (_cache[5] = [_createTextVNode(\" 删除 \")]));\n                      }),\n                      _: 2 /* DYNAMIC */\n                    }, 1032 /* PROPS, DYNAMIC_SLOTS */, [\"onClick\"])])])];\n                  }),\n                  _: 2 /* DYNAMIC */\n                }, 1024 /* DYNAMIC_SLOTS */)];\n              }),\n              _: 2 /* DYNAMIC */\n            }, 1032 /* PROPS, DYNAMIC_SLOTS */, [\"timestamp\"]);\n          }), 128 /* KEYED_FRAGMENT */))];\n        }),\n        _: 1 /* STABLE */\n      }))])];\n    }),\n    _: 1 /* STABLE */\n  })) : _createCommentVNode(\"v-if\", true)]);\n}","map":{"version":3,"names":["_createElementBlock","_hoisted_1","_createCommentVNode","_createVNode","_component_el_card","header","_withCtx","_cache","_createElementVNode","_hoisted_2","_component_el_form","model","$setup","form","_component_el_form_item","label","_component_el_select","modelValue","fileId","$event","placeholder","filterable","onChange","handleFileSelect","style","_Fragment","_renderList","fileList","file","_createBlock","_component_el_option","key","id","original_name","value","_","_component_el_button","type","disabled","onClick","handleCreateBackup","_createTextVNode","_hoisted_3","_hoisted_4","_toDisplayString","selectedFileName","_hoisted_5","backupList","length","_component_el_empty","description","_component_el_timeline","backup","_component_el_timeline_item","timestamp","formatDate","created_at","placement","_hoisted_6","_hoisted_7","version","_hoisted_8","link","handleRestore","_toConsumableArray","handleDelete"],"sources":["/home/devbox/project/src/views/backup/index.vue"],"sourcesContent":["<template>\n  <div class=\"backup-container\">\n    <!-- 文件选择和备份操作 -->\n    <el-card class=\"operation-card\">\n      <template #header>\n        <div class=\"card-header\">\n          <span>备份管理</span>\n        </div>\n      </template>\n\n      <div class=\"operation-content\">\n        <el-form :model=\"form\" label-width=\"80px\">\n          <el-form-item label=\"选择文件\">\n            <el-select\n              v-model=\"form.fileId\"\n              placeholder=\"请选择文件\"\n              filterable\n              @change=\"handleFileSelect\"\n              style=\"width: 100%\"\n            >\n              <el-option\n                v-for=\"file in fileList\"\n                :key=\"file.id\"\n                :label=\"file.original_name\"\n                :value=\"file.id\"\n              />\n            </el-select>\n          </el-form-item>\n\n          <el-form-item>\n            <el-button\n              type=\"primary\"\n              :disabled=\"!form.fileId\"\n              @click=\"handleCreateBackup\"\n            >\n              创建备份\n            </el-button>\n          </el-form-item>\n        </el-form>\n      </div>\n    </el-card>\n\n    <!-- 备份列表 -->\n    <el-card v-if=\"form.fileId\" class=\"backup-list-card\">\n      <template #header>\n        <div class=\"card-header\">\n          <span>备份列表</span>\n          <span class=\"file-name\">{{ selectedFileName }}</span>\n        </div>\n      </template>\n\n      <div class=\"backup-list\">\n        <el-empty v-if=\"!backupList.length\" description=\"暂无备份\" />\n        \n        <el-timeline v-else>\n          <el-timeline-item\n            v-for=\"backup in backupList\"\n            :key=\"backup.id\"\n            :timestamp=\"formatDate(backup.created_at)\"\n            placement=\"top\"\n          >\n            <el-card class=\"backup-item\">\n              <div class=\"backup-info\">\n                <span class=\"version\">版本 {{ backup.version }}</span>\n                <div class=\"operations\">\n                  <el-button\n                    type=\"primary\"\n                    link\n                    @click=\"handleRestore(backup)\"\n                  >\n                    恢复到此版本\n                  </el-button>\n                  <el-button\n                    type=\"danger\"\n                    link\n                    @click=\"handleDelete(backup)\"\n                  >\n                    删除\n                  </el-button>\n                </div>\n              </div>\n            </el-card>\n          </el-timeline-item>\n        </el-timeline>\n      </div>\n    </el-card>\n  </div>\n</template>\n\n<script setup>\nimport { ref, computed } from 'vue';\nimport { ElMessage, ElMessageBox } from 'element-plus';\nimport { getFileList } from '@/api/file';\nimport {\n  createBackup,\n  getBackupList,\n  restoreBackup,\n  deleteBackup\n} from '@/api/backup';\n\n// 状态变量\nconst fileList = ref([]);\nconst backupList = ref([]);\nconst form = ref({\n  fileId: null\n});\n\n// 计算选中的文件名\nconst selectedFileName = computed(() => {\n  const file = fileList.value.find(f => f.id === form.value.fileId);\n  return file ? file.original_name : '';\n});\n\n// 获取文件列表\nconst getFiles = async () => {\n  try {\n    const res = await getFileList({ pageSize: 1000 });\n    fileList.value = res.Data.files;\n  } catch (error) {\n    console.error('获取文件列表失败:', error);\n  }\n};\n\n// 获取备份列表\nconst getBackups = async (fileId) => {\n  try {\n    const res = await getBackupList(fileId);\n    backupList.value = res.Data;\n  } catch (error) {\n    console.error('获取备份列表失败:', error);\n  }\n};\n\n// 选择文件\nconst handleFileSelect = async (fileId) => {\n  if (fileId) {\n    await getBackups(fileId);\n  } else {\n    backupList.value = [];\n  }\n};\n\n// 创建备份\nconst handleCreateBackup = async () => {\n  if (!form.value.fileId) return;\n\n  try {\n    await createBackup(form.value.fileId);\n    ElMessage.success('创建备份成功');\n    await getBackups(form.value.fileId);\n  } catch (error) {\n    console.error('创建备份失败:', error);\n  }\n};\n\n// 恢复备份\nconst handleRestore = async (backup) => {\n  try {\n    await ElMessageBox.confirm(\n      `确定要将文件恢复到版本 ${backup.version} 吗？`,\n      '提示',\n      {\n        type: 'warning',\n        confirmButtonText: '确定',\n        cancelButtonText: '取消'\n      }\n    );\n\n    await restoreBackup(form.value.fileId, backup.version);\n    ElMessage.success('恢复成功');\n  } catch (error) {\n    if (error !== 'cancel') {\n      console.error('恢复备份失败:', error);\n    }\n  }\n};\n\n// 删除备份\nconst handleDelete = async (backup) => {\n  try {\n    await ElMessageBox.confirm(\n      `确定要删除版本 ${backup.version} 的备份吗？`,\n      '提示',\n      {\n        type: 'warning',\n        confirmButtonText: '确定',\n        cancelButtonText: '取消'\n      }\n    );\n\n    await deleteBackup(backup.id);\n    ElMessage.success('删除成功');\n    await getBackups(form.value.fileId);\n  } catch (error) {\n    if (error !== 'cancel') {\n      console.error('删除备份失败:', error);\n    }\n  }\n};\n\n// 格式化日期\nconst formatDate = (date) => {\n  return new Date(date).toLocaleString();\n};\n\n// 初始化\ngetFiles();\n</script>\n\n<style lang=\"scss\" scoped>\n.backup-container {\n  display: grid;\n  grid-template-columns: 300px 1fr;\n  gap: 20px;\n\n  .card-header {\n    display: flex;\n    align-items: center;\n    gap: 20px;\n\n    .file-name {\n      color: #666;\n      font-size: 14px;\n    }\n  }\n\n  .backup-list {\n    min-height: 200px;\n\n    .backup-item {\n      .backup-info {\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n\n        .version {\n          font-weight: bold;\n        }\n\n        .operations {\n          display: flex;\n          gap: 10px;\n        }\n      }\n    }\n  }\n}\n</style>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}